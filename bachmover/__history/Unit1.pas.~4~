unit Unit1;

interface

uses
  System.SysUtils, System.Types, System.UITypes, System.Classes, System.Variants,
  FMX.Types, FMX.Controls, FMX.Forms, FMX.Graphics, FMX.Dialogs,
  FireDAC.Stan.Intf, FireDAC.Stan.Option, FireDAC.Stan.Error, FireDAC.UI.Intf,
  FireDAC.Phys.Intf, FireDAC.Stan.Def, FireDAC.Stan.Pool, FireDAC.Stan.Async,
  FireDAC.Phys, FireDAC.FMXUI.Wait, FireDAC.Stan.Param, FireDAC.DatS,
  FireDAC.DApt.Intf, FireDAC.DApt, REST.Types, Data.Bind.EngExt,
  Fmx.Bind.DBEngExt, FMX.TMSLiveGridDataBinding, System.Rtti,
  System.Bindings.Outputs, Fmx.Bind.Editors, FireDAC.Comp.BatchMove.DataSet,
  FireDAC.Comp.BatchMove, Data.Bind.Components, Data.Bind.Grid,
  Data.Bind.DBScope, FireDAC.Comp.Client, REST.Response.Adapter, REST.Client,
  Data.Bind.ObjectScope, Data.DB, FireDAC.Comp.DataSet, FMX.TMSBaseControl,
  FMX.TMSGridCell, FMX.TMSGridOptions, FMX.TMSGridData, FMX.TMSCustomGrid,
  FMX.TMSLiveGrid, FireDAC.Phys.SQLite, FireDAC.Phys.SQLiteDef,
  FireDAC.Stan.ExprFuncs, FMX.Controls.Presentation, FMX.StdCtrls,
  FireDAC.Comp.BatchMove.SQL, FireDAC.Stan.StorageJSON, FireDAC.Comp.UI,System.JSON,
  Fmx.Bind.Grid, FMX.Grid.Style, FMX.ScrollBox, FMX.Grid;

type
  TForm1 = class(TForm)
    TMSFMXLiveGrid1: TTMSFMXLiveGrid;
    RESTClient1: TRESTClient;
    RESTRequest1: TRESTRequest;
    RESTResponse1: TRESTResponse;
    RESTResponseDataSetAdapter1: TRESTResponseDataSetAdapter;
    FDMemTable1: TFDMemTable;
    BindSourceDB1: TBindSourceDB;
    BindingsList1: TBindingsList;
    BindSourceDB2: TBindSourceDB;
    FDBatchMoveDataSetReader1: TFDBatchMoveDataSetReader;
    FDPhysSQLiteDriverLink1: TFDPhysSQLiteDriverLink;
    Button1: TButton;
    FDBatchMove1: TFDBatchMove;
    FDMemTable1id: TWideStringField;
    FDMemTable1Materiale: TWideStringField;
    FDMemTable1Descripzione: TWideStringField;
    FDMemTable1Quantita: TWideStringField;
    FDMemTable1Treno: TWideStringField;
    FDMemTable1Discorta: TWideStringField;
    FDMemTable1Commento: TWideStringField;
    FDMemTable1Data: TWideStringField;
    FDMemTable1Creatoda: TWideStringField;
    FDMemTable1Ordinato: TWideStringField;
    LinkGridToDataSourceBindSourceDB1: TLinkGridToDataSource;
    FDBatchMoveSQLWriter1: TFDBatchMoveSQLWriter;
    FDStanStorageJSONLink1: TFDStanStorageJSONLink;
    DataSource1: TDataSource;
    BindSourceDB3: TBindSourceDB;
    FDGUIxWaitCursor1: TFDGUIxWaitCursor;
    FDQuery1: TFDQuery;
    Button2: TButton;
    BindSourceDB4: TBindSourceDB;
    Button3: TButton;
    FDQuery1ID: TFDAutoIncField;
    FDQuery1MATERIALE: TWideMemoField;
    FDQuery1DESCRIPZIONE: TWideMemoField;
    FDQuery1QUANTITA: TWideMemoField;
    FDQuery1TRENO: TBlobField;
    FDQuery1DISCORTA: TWideMemoField;
    FDQuery1COMMENTO: TWideMemoField;
    FDQuery1DATA: TWideMemoField;
    FDQuery1CREATODA: TWideMemoField;
    FDQuery1ORDINATO: TWideMemoField;
    StringGrid1: TStringGrid;
    BindSourceDB5: TBindSourceDB;
    FDConnection1: TFDConnection;
    FDTable1: TFDTable;
    FDTable1ID: TFDAutoIncField;
    FDTable1MATERIALE: TWideMemoField;
    FDTable1DESCRIPZIONE: TWideMemoField;
    FDTable1QUANTITA: TWideMemoField;
    FDTable1TRENO: TBlobField;
    FDTable1DISCORTA: TWideMemoField;
    FDTable1COMMENTO: TWideMemoField;
    FDTable1DATA: TWideMemoField;
    FDTable1CREATODA: TWideMemoField;
    FDTable1ORDINATO: TWideMemoField;
    BindSourceDB6: TBindSourceDB;
    LinkGridToDataSourceBindSourceDB6: TLinkGridToDataSource;
    procedure Button1Click(Sender: TObject);
    procedure Button2Click(Sender: TObject);
    procedure Button3Click(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Form1: TForm1;

implementation

{$R *.fmx}

procedure TForm1.Button1Click(Sender: TObject);
begin
RESTRequest1.Execute;
FDBatchMove1.Execute;

FDConnection1.Connected:=False;
FDConnection1.Connected:=True;
FDQuery1.Active:=False;
FDQuery1.Active:=True;
FDQuery1.SQL.Clear;
FDQuery1.SQL.Add('Select * From RICHIESTA') ;
FDQuery1.Open();
end;

procedure TForm1.Button2Click(Sender: TObject);
begin

FDConnection1.Connected:=True;
FDQuery1.Active:=False;
FDQuery1.Active:=True;
FDQuery1.SQL.Clear;
FDQuery1.SQL.Add('Select * From RICHIESTA') ;
FDQuery1.Open();
FDTable1.Active:=True;
end;

procedure TForm1.Button3Click(Sender: TObject);
var
  aggiornarichiesta: TJSONObject;
  i: Integer;
begin

    for I := 0 to FDTable1.FieldCount.MaxValue do
     begin
    aggiornarichiesta := TJSONObject.Create;
    aggiornarichiesta.AddPair('id', FDTable1ID.Text);
    aggiornarichiesta.AddPair('Materiale',  FDTable1.FieldByName ('Materiale'). AsString);
    aggiornarichiesta.AddPair('Descripzione', FDTable1.FieldByName ('Descripzione'). AsString);
    aggiornarichiesta.AddPair('Quantita', FDTable1.FieldByName ('Quantita'). AsString);
    aggiornarichiesta.AddPair('Treno', FDTable1.FieldByName ('Treno'). AsString);
    aggiornarichiesta.AddPair('Discorta', FDTable1.FieldByName ('Discorta'). AsString);
    aggiornarichiesta.AddPair('Commento', FDTable1.FieldByName ('Commento'). AsString);
    aggiornarichiesta.AddPair('Creatoda', FDTable1.FieldByName ('Creatoda'). AsString);
    aggiornarichiesta.AddPair('Ordinato', FDTable1.FieldByName ('Ordinato'). AsString);

    RESTClient1.BaseURL := 'http://localhost/loman/Product/update.php';
    RESTRequest1.ClearBody;
    RESTRequest1.AddBody(aggiornarichiesta.ToString,
      ContentTypeFromString('application/json'));
    RESTRequest1.Execute;
    FDTable1.Next
     end;
end;

end.
